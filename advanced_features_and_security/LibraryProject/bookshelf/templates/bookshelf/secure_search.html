{% extends 'bookshelf/base.html' %}

{% block title %}Secure Search - Library Management System{% endblock %}

{% block header %}Secure Book Search{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="padding: 20px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
        <h3>Security Features Demonstrated:</h3>
        <ul>
            <li><strong>CSRF Protection:</strong> All forms include CSRF tokens</li>
            <li><strong>Input Validation:</strong> Server-side validation of all inputs</li>
            <li><strong>XSS Prevention:</strong> All user input is properly escaped</li>
            <li><strong>SQL Injection Prevention:</strong> Using Django ORM with parameterized queries</li>
        </ul>
    </div>
    
    <!-- Secure Search Form with CSRF Protection -->
    <form method="get" action="{% url 'bookshelf:secure_search' %}" style="margin-bottom: 30px;">
        {% csrf_token %}
        <div style="display: flex; gap: 10px; align-items: end;">
            <div style="flex: 1;">
                <label for="search_query" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Search Books:
                </label>
                <input type="text" 
                       id="search_query" 
                       name="search_query" 
                       value="{{ search_query|default:'' }}"
                       placeholder="Enter book title or author..."
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                       maxlength="100">
            </div>
            <div>
                <label for="search_type" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Search In:
                </label>
                <select id="search_type" 
                        name="search_type" 
                        style="padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="title" {% if search_type == 'title' %}selected{% endif %}>Title</option>
                    <option value="author" {% if search_type == 'author' %}selected{% endif %}>Author</option>
                    <option value="both" {% if search_type == 'both' %}selected{% endif %}>Both</option>
                </select>
            </div>
            <div>
                <button type="submit" 
                        style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Search
                </button>
            </div>
        </div>
    </form>
    
    <!-- Secure Contact Form with CSRF Protection -->
    <div style="border-top: 2px solid #dee2e6; padding-top: 20px;">
        <h3>Contact Form (CSRF Protected)</h3>
        <form method="post" action="{% url 'bookshelf:secure_contact' %}">
            {% csrf_token %}
            <div style="margin-bottom: 15px;">
                <label for="contact_name" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Name: <span style="color: red;">*</span>
                </label>
                <input type="text" 
                       id="contact_name" 
                       name="contact_name" 
                       required
                       maxlength="100"
                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label for="contact_email" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Email: <span style="color: red;">*</span>
                </label>
                <input type="email" 
                       id="contact_email" 
                       name="contact_email" 
                       required
                       maxlength="254"
                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label for="contact_message" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Message: <span style="color: red;">*</span>
                </label>
                <textarea id="contact_message" 
                          name="contact_message" 
                          required
                          maxlength="1000"
                          rows="4"
                          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
            </div>
            
            <button type="submit" 
                    style="padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Send Message
            </button>
        </form>
    </div>
    
    <!-- Security Information -->
    <div style="margin-top: 30px; padding: 20px; background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 8px;">
        <h4>Security Measures in This Form:</h4>
        <ul>
            <li><strong>CSRF Token:</strong> {% csrf_token %} prevents Cross-Site Request Forgery attacks</li>
            <li><strong>Input Validation:</strong> HTML5 validation attributes (required, maxlength, type="email")</li>
            <li><strong>Server-side Validation:</strong> Django forms provide additional validation</li>
            <li><strong>XSS Prevention:</strong> Django automatically escapes template variables</li>
            <li><strong>SQL Injection Prevention:</strong> Django ORM uses parameterized queries</li>
        </ul>
    </div>
</div>
{% endblock %}
